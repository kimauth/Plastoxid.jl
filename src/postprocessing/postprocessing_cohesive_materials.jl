################################################################
# Coupled cohesive zone
################################################################

function postprocess_material(
    Î”::Vec{dim}, 
    cáµáµ‡,
    material::CoupledKolluri,
    state::CoupledKolluriState{dim},
    old_state::CoupledKolluriState{dim},
    Î”t::Float64,
) where dim
    
    (; Î”â‚˜â‚â‚“, cáµáµ‡â‚˜â‚â‚“) = state

    dn, dct, dt, dcn, do2 = damage_variables(material, state)
    dn_old, dct_old, dt_old, dcn_old, do2_old = damage_variables(material, old_state)
    âˆ‚dnâˆ‚t, âˆ‚dctâˆ‚t, âˆ‚dtâˆ‚t, âˆ‚dcnâˆ‚t, âˆ‚do2âˆ‚t = damage_time_derivatives(material, dn, dct, dt, dcn, do2, dn_old, dct_old, dt_old, dcn_old, do2_old, Î”t)
    âˆ‚Î¨âˆ‚dn, âˆ‚Î¨âˆ‚dct, âˆ‚Î¨âˆ‚dt, âˆ‚Î¨âˆ‚dcn, âˆ‚Î¨âˆ‚do2 = damage_driving_forces(material, Î”, cáµáµ‡, dn, dct, dt, dcn, do2)

    ğ”‡ = dissipation(material, âˆ‚Î¨âˆ‚dn, âˆ‚Î¨âˆ‚dct, âˆ‚Î¨âˆ‚dt, âˆ‚Î¨âˆ‚dcn, âˆ‚Î¨âˆ‚do2, âˆ‚dnâˆ‚t, âˆ‚dctâˆ‚t, âˆ‚dtâˆ‚t, âˆ‚dcnâˆ‚t, âˆ‚do2âˆ‚t)

    d_mech = dn * dct * dt * dcn

    _T = T(material, Î”, Î”â‚˜â‚â‚“, cáµáµ‡, cáµáµ‡â‚˜â‚â‚“)
    _TÌ‚â‚™ = TÌ‚â‚™(material, Î”, Î”â‚˜â‚â‚“, cáµáµ‡â‚˜â‚â‚“)

    return d_mech, do2, _T, _TÌ‚â‚™, cáµáµ‡, state.cáµáµ‡â‚˜â‚â‚“, ğ”‡
end

@inline pp_types(::Type{CoupledKolluri}, ::Type{<:AbstractDim{dim}}) where dim = (
    d_mech = Float64,
    d_o2 = Float64,
    T = Vec{dim, Float64},
    TÌ‚â‚™ = Float64,
    cáµáµ‡ = Float64,
    cáµáµ‡â‚˜â‚â‚“ = Float64,
    ğ”‡ = Float64
)

# could this be autogenerated?
function postprocess_material!(
    # preallocated matrices
    matrices,
    cellid,
    qp,
    # args
    Î”::Vec{dim}, 
    cáµáµ‡,
    material::CoupledKolluri,
    state::CoupledKolluriState{dim},
    old_state::CoupledKolluriState{dim},
    Î”t::Float64,
) where dim
    d_mech, do2, _T, _TÌ‚â‚™, cáµáµ‡, cáµáµ‡â‚˜â‚â‚“, ğ”‡ = postprocess_material(Î”, cáµáµ‡, material, state, old_state, Î”t::Float64)

    # set values into pre-allocated matrices
    matrices.d_mech[qp, cellid] = d_mech
    matrices.d_o2[qp, cellid] = do2
    matrices.T[qp, cellid] = _T
    matrices.TÌ‚â‚™[qp, cellid] = _TÌ‚â‚™
    matrices.cáµáµ‡[qp, cellid] = cáµáµ‡
    matrices.cáµáµ‡â‚˜â‚â‚“[qp, cellid] = cáµáµ‡â‚˜â‚â‚“
    matrices.ğ”‡[qp, cellid] = ğ”‡

    return matrices
end